# TechDocs Pipeline Demo

This repository contains a GitHub Actions workflow that builds and publishes TechDocs documentation to an AWS S3 bucket. These pre-generated docs can then be consumed by a Backstage instance configured in external TechDocs mode.


## MkDocs Plugins Used and How to Add More

This setup uses [`techdocs-core`](https://github.com/backstage/mkdocs-techdocs-core) and [`minify`](https://github.com/byrnereese/mkdocs-minify-plugin) plugins.

To add more plugins:
1. Modify the [`mkdocs.yml`](https://github.com/04kash/techdocs-pipeline-demo/blob/main/mkdocs.yaml) file to include the desired plugin under the `plugins:` section.
2. Modify the ["Install mkdocs and mkdocs plugins" step](https://github.com/04kash/techdocs-pipeline-demo/blob/main/.github/workflows/generate-and-publish-no-docker.yaml#L52) in the workflow to install the additonal plugins.

## Backstage `app-config.yaml` Setup

To serve the TechDocs generated by this workflow in your Backstage instance, update your `app-config.yaml` with the following configuration:

```yaml
techdocs:
  # Use 'external' builder mode to prevent Backstage from generating docs at runtime.
  # This assumes TechDocs have already been built and uploaded to your storage.
  builder: 'external'
 # Configure allowed iframe hosts for embedding content (e.g., YouTube videos) in your docs.
 # Add any additional domains you embed content from here.
 # see: https://backstage.io/docs/features/techdocs/how-to-guides/#how-to-enable-iframes-in-techdocs
  sanitizer:
    allowedIframeHosts:
      - www.youtube.com
  publisher:
    type: 'awsS3'
    awsS3:
      bucketName: $AWS_S3_BUCKET_NAME
      accountId: $AWS_ACCOUNT_ID
      region: $AWS_REGION

# see: https://backstage.io/docs/features/techdocs/using-cloud-storage/#configuring-aws-s3-bucket-with-techdocs for alternate ways to authenticate with with AWS
aws:
  accounts:
    - accountId: $AWS_ACCOUNT_ID
      accessKeyId: $AWS_ACCESS_KEY_ID
      secretAccessKey: $AWS_SECRET_ACCESS_KEY
```

Also ingest the catalog-info.yaml file in this repo to be able to view the techdocs, as in backstage docs are linked to entities following a docs-like-code approach. Remember to mention the [backstage.io/techdocs-ref](https://backstage.io/docs/features/techdocs/how-to-guides/#how-to-understand-techdocs-ref-annotation-values) annotation! 

## Helpful Resources
- [Configuring AWS S3 Bucket with TechDocs](https://backstage.io/docs/features/techdocs/using-cloud-storage/#configuring-aws-s3-bucket-with-techdocs)
- [An example workflow using GitHub Actions CI and AWS S3 storage](https://backstage.io/docs/features/techdocs/configuring-ci-cd/)
- [How to migrate from TechDocs Basic to Recommended deployment approach?](https://backstage.io/docs/features/techdocs/how-to-guides/#how-to-migrate-from-techdocs-basic-to-recommended-deployment-approach)
